<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
			http://www.springframework.org/schema/beans 
	   		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	   		http://www.springframework.org/schema/context
	   		http://www.springframework.org/schema/context/spring-context-3.0.xsd
			http://www.springframework.org/schema/util
			http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<!-- Este fichero contiene la configuracion de Spring de las librerias    -->
	<!-- SCSP V3. Evite realizar modificaciones en este fichero ya que la     -->
	<!-- configuracion se debera realizar a traves de base de datos.          -->

	<!-- Modificacions PINBAL:                                                -->
	<!--     1.- Substituir el scspPropertyPlaceholderConfigurer per un altre -->
	<!--         que agafa la configuració dels properties de PINBAL.         -->
	<!--     2.- Canviar les propietats de ${config: a                        -->
	<!--         ${config:es.caib.pinbal.scsp                                 -->
	<!--     3.- Modificar el sessionFactory per agafar el mateix dataSource  -->
	<!--         que te PINBAL.                                               -->
	<!--     4.- Desactivar el proxyManager comentant properties.             -->

	<context:annotation-config />
	<context:component-scan base-package="es.scsp" />

	<!-- ==================================================================== -->
	<!-- Gestores de configuración                                            -->
	<!-- ==================================================================== -->
	<alias name="propertyPlaceholderConfigurer" alias="scspPropertyPlaceholderConfigurer" />
	<bean class="es.scsp.common.security.PolicyBuilder">
		<constructor-arg index="0" value="/scsp-ws-policy.xml" />
	</bean>
	<bean id="parametroConfiguracionDao" class="es.scsp.common.dao.ParametroConfiguracionDao"/> 
	<alias name="clienteUnico" alias="clienteUnicoProvisional" />

	<!-- ==================================================================== -->
	<!-- Configuracion de binding.                                            -->
	<!-- ==================================================================== -->
	<alias name="jibxMarshaller" alias="marshaller" />
	<alias name="jibxMarshaller" alias="unmarshaller" />

	<!-- ==================================================================== -->
	<!-- Configuracion de acceso base de datos.                               -->
	<!-- ==================================================================== -->
	<bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="packagesToScan" value="es.scsp.common.domain.**" />
		<property name="hibernateProperties">
			<value>
				hibernate.dialect=${config:es.caib.pinbal.hibernate.dialect}
				hibernate.hbm2ddl.auto=${config:es.caib.pinbal.hibernate.hbm2ddl.auto}
				hibernate.show_sql=${config:es.caib.pinbal.hibernate.show_sql}
				hibernate.transaction.factory_class=org.hibernate.transaction.JDBCTransactionFactory
				hibernate.current_session_context_class=thread
				hibernate.dbcp.enabled=false
				hibernate.dbcp.initialSize=10
				hibernate.dbcp.maxActive=50
				hibernate.dbcp.minIdle=15
				hibernate.dbcp.maxIdle=50
				hibernate.dbcp.maxWait=5000
				hibernate.c3p0.idle_test_period=300
				hibernate.c3p0.timeout=500
				hibernate.c3p0.max_size=25
				hibernate.c3p0.min_size=3
				hibernate.c3p0.validate.in=true
				hibernate.c3p0.validate.out=true
      		</value>
		</property>
	</bean>

	<!-- ==================================================================== -->
	<!-- Recursos adicionales.                                                -->
	<!-- ==================================================================== -->
	<bean id="dateFormater" class="java.text.SimpleDateFormat">
		<constructor-arg value="yyyy-MM-dd'T'HH:mm:ss.SSSZ" />
	</bean>

	<!-- ==================================================================== -->
	<!-- Cliente Spring de Afirma                                             -->
	<!-- ==================================================================== -->
	<bean id="messageFactory" class="org.springframework.ws.soap.axiom.AxiomSoapMessageFactory" />
	<bean id="afirmaWssHandler" class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor">
		<property name="securementActions" value="Signature" />
		<property name="securementSignatureKeyIdentifier" value="DirectReference" />
		<property name="securementMustUnderstand" value="false" />
		<property name="securementSignatureCrypto">
			<bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean">
				<property name="keyStorePassword" value="${config:es.caib.pinbal.scsp.keystorePass}" />
				<property name="keyStoreLocation" value="${config:es.caib.pinbal.scsp.keystoreFile}" />
			</bean>
		</property>
	</bean>
	<bean id="proxyManager" class="es.scsp.common.utils.ProxyManager">
		<!--property name="host"  value="${config:es.caib.pinbal.scsp.proxy.host}" />
		<property name="port"  value="${config:es.caib.pinbal.scsp.proxy.port}" /> 
		<property name="user"  value="${config:es.caib.pinbal.scsp.proxy.user}" /> 
		<property name="password"  value="${config:es.caib.pinbal.scsp.proxy.password}" />
		<property name="domain"  value="${config:es.caib.pinbal.scsp.proxy.domain}" />
		<property name="nonHostsProxy"  value="${config:es.caib.pinbal.scsp.proxy.non.proxy.hosts}" /-->
	</bean>

</beans>
